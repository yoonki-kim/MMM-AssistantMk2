class AssistantHelper{constructor(t){this.config=t,this.helper={},this.events={},this.locked=!1,this.subdom={mic:null,message:null,wrapper:null},this.dom=this.prepareDom(),this.status="STANDBY",this.nextQuery="",console.log("[AMk2] AssistantHelper Initialized !")}registerHelper(t,s){this.helper[t]=s}log(t){this.config.verbose&&console.log("[AMK2] ",t)}configure(t){this.config=t}initializeAfterLoading(){window.addEventListener("message",t=>{this.screenMessage(t.data)},!1)}prepareDom(){var t=document.createElement("div");t.id="ASSISTANT",t.className="STANDBY";var s=document.createElement("div");s.id="ASSISTANT_MIC",this.config.standbyStatic&&(s.className="static"),s.onclick=(t=>{t.stopPropagation(),this.activate()}),t.appendChild(s);var e=document.createElement("div");return e.id="ASSISTANT_MESSAGE",t.appendChild(e),this.subdom.mic=s,this.subdom.message=e,this.subdom.wrapper=t,t}on(t,s=(()=>{})){this.events[t]=s}off(t){this.events.hasOwnProperty(t)&&delete this.events[t]}emit(t,s){if(this.events.hasOwnProperty(t)){var e=this.events[t];"function"==typeof e&&e(s)}}transcription(t){t.done&&this.changeStatus("UNDERSTANDING"),this.subdom.message.innerHTML="<p>"+t.transcription+"</p>"}changeStatus(t){t&&(this.status=t,this.subdom.wrapper.className=t),this.sendNotification("ASSISTANT_"+t),"STANDBY"==t&&(this.subdom.mic.className="",this.config.standbyStatic&&(this.subdom.mic.className="static"))}getStatus(){return this.status}isLocked(){return this.locked}drawDom(){return this.dom}sendSocketNotification(t,s){this.helper.sendSocketNotification(t,s)}sendNotification(t,s){this.helper.sendNotification(t,s)}onError(t){this.changeStatus("ERROR"),this.subdom.message.innerHTML="<p>"+t+"</p>",setTimeout(()=>{this.clearResponse(),this.deactivate()},3e3)}activate(t=null,s=null){return"STANDBY"==this.status||"UNDERSTANDING"==this.status||"RESPONSING"==this.status?(this.clearResponse(),this.sendSocketNotification("SNOWBOY_STOP"),this.changeStatus("READY"),this.sendSocketNotification("START",{textQuery:t,id:s}),!0):(this.log("Assistant is busy."),!1)}deactivate(t=(()=>{})){this.changeStatus("STANDBY"),this.sendSocketNotification("SNOWBOY_START"),t()}clearResponse(){this.subdom.message.innerHTML=""}micStatus(t){this.subdom.mic.className=t?"MIC":""}speakerStatus(t){this.subdom.mic.className=t?"SPEAKER":""}foundError(t){if(t){var s="";s="string"==typeof t?t:t.toString(),this.log("Error:"+s)}}conversationEnd(t){this.foundError(t.error),t.continueConversation?this.activate():(this.clearResponse(),this.deactivate())}screenMessage(t){t.hasOwnProperty("query")&&t.query.queryText&&this.deactivate(()=>{this.activate(t.query.queryText)})}}
